var m=class i{constructor(t=0,e=0){this.x=t;this.y=e}clone(){return new i(this.x,this.y)}add(t){return new i(this.x+t.x,this.y+t.y)}sub(t){return new i(this.x-t.x,this.y-t.y)}scale(t,e=t){return new i(this.x*t,this.y*e)}dot(t){return this.x*t.x+this.y*t.y}perp(){return new i(-this.y,this.x)}len(){return Math.hypot(this.x,this.y)}norm(){let t=this.len()||1;return new i(this.x/t,this.y/t)}rotate(t,e=null){let r=Math.cos(t),n=Math.sin(t),s=this.x,o=this.y;e&&(s-=e.x,o-=e.y);let a=s*r-o*n,u=s*n+o*r;return e?new i(a+e.x,u+e.y):new i(a,u)}toArray(){return[this.x,this.y]}static fromArray(t){return new i(t[0],t[1])}static lerp(t,e,r){return new i(t.x+(e.x-t.x)*r,t.y+(e.y-t.y)*r)}};var k=Object.freeze({black:[0,0,0,255],white:[255,255,255,255],red:[255,0,0,255],green:[0,255,0,255],blue:[0,0,255,255],yellow:[255,255,0,255],cyan:[0,255,255,255],magenta:[255,0,255,255],gray:[128,128,128,255],grey:[128,128,128,255],orange:[255,165,0,255],transparent:[0,0,0,0]});function X(i){return i<0?0:i>255?255:i|0}function ut(i){return i<0?0:i>1?1:i}function C(i){if(Array.isArray(i)){let[e,r,n,s=255]=i;return[e|0,r|0,n|0,s|0]}if(typeof i!="string")return null;let t=i.trim().toLowerCase();if(t in k)return k[t];if(t[0]==="#"){let e=t.slice(1),r=e.length,n=s=>parseInt(e[s]+(r<6?e[s]:e[s+1]||e[s]),16);switch(r){case 3:return[n(0),n(1),n(2),255];case 4:return[n(0),n(1),n(2),n(3)];case 6:return[parseInt(e.slice(0,2),16),parseInt(e.slice(2,4),16),parseInt(e.slice(4,6),16),255];case 8:return[parseInt(e.slice(0,2),16),parseInt(e.slice(2,4),16),parseInt(e.slice(4,6),16),parseInt(e.slice(6,8),16)];default:return null}}if(t.startsWith("rgb")){let e=t.match(/\d+\.?\d*/g);if(!e||e.length!==3&&e.length!==4)return null;let r=X(+e[0]),n=X(+e[1]),s=X(+e[2]),o=e[3]==null?255:ut(+e[3])*255+.5|0;return[r,n,s,o]}return null}function $(i,t,e,r){return r<<24|e<<16|t<<8|i}function xt(i){return[i&255,i>>>8&255,i>>>16&255,i>>>24&255]}function S(i,t,e,r,n,s,o,a){let u=r/255,h=a/255,l=h+u*(1-h);if(l<=0)return[0,0,0,0];let d=1-h,c=(n*h+i*u*d)/l,b=(s*h+t*u*d)/l,f=(o*h+e*u*d)/l;return[c,b,f,l*255]}function pt(i){if(Array.isArray(i)){let t=i;return[t[0]|0,t[1]|0,t[2]|0,(t[3]??255)|0]}else return C(i)||k.white}function G(i,t,e,r){let n=r,s=Math.round(t.x),o=Math.round(t.y),a=Math.round(e.x),u=Math.round(e.y),h=Math.abs(a-s),l=Math.abs(u-o),d=s<a?1:-1,c=o<u?1:-1,b=h-l,f=i.buffer;for(;f.putPixelBlend(s,o,n),!(s===a&&o===u);){let x=b<<1;x>-l&&(b-=l,s+=d),x<h&&(b+=h,o+=c)}}function N(i,t,e,{type:r="circle",size:n=3}={}){if(r==="circle")R(i,t,n,e);else if(r==="cross")G(i,new m(t.x-n,t.y),new m(t.x+n,t.y),e),G(i,new m(t.x,t.y-n),new m(t.x,t.y+n),e);else if(r==="square"){let s=n|0,o=[new m(t.x-s,t.y-s),new m(t.x+s,t.y-s),new m(t.x+s,t.y+s),new m(t.x-s,t.y+s)];I(i,o,e,1)}}function I(i,t,e,r=1){for(let n=0;n<t.length;n++){let s=t[n],o=t[(n+1)%t.length];if(r<=1){G(i,s,o,e);continue}let a=o.sub(s),u=a.len()||1,h=a.scale(1/u),l=new m(-h.y,h.x),d=r/2|0;for(let c=-d;c<=d;c++){let b=l.scale(c);G(i,s.add(b),o.add(b),e)}}}function R(i,t,e,r){let n=e*e,s=Math.max(0,Math.floor(t.x)|0),o=Math.min(i.buffer.width-1,Math.ceil(t.x)|0),a=Math.max(0,Math.floor(t.y)|0),u=Math.min(i.buffer.height-1,Math.ceil(t.y)|0),h=i.buffer.pixels,l=i.buffer.width;for(let d=a;d<=u;d++){let c=d-t.y,b=c*c,f=(d*l+s|0)*4;for(let x=s;x<=o;x++,f+=4){let p=x-t.x;if(p*p+b<=n){let g=h[f],w=h[f+1],y=h[f+2],T=h[f+3],[B,z,D,P]=S(g,w,y,T,r[0],r[1],r[2],r[3]);h[f]=B+.5|0,h[f+1]=z+.5|0,h[f+2]=D+.5|0,h[f+3]=P+.5|0}}}}function A(i,t,e){let r=t?.length|0;if(r<3)return;let n=i.buffer.height|0,s=i.buffer.width|0,o=1/0,a=-1/0,u=[];for(let l=0;l<r;l++){let d=t[l],c=t[(l+1)%r],b=d.x,f=d.y,x=c.x,p=c.y;if(f===p)continue;let g=Math.min(f,p),w=Math.max(f,p),y=f<p?b:x,T=(x-b)/(p-f);u.push({ymin:g,ymax:w,x:y,invSlope:T}),g<o&&(o=g),w>a&&(a=w)}o=Math.max(0,Math.floor(o)|0),a=Math.min(n-1,Math.ceil(a)|0);let h=i.buffer.pixels;for(let l=o;l<=a;l++){let d=[];for(let c of u)l>=c.ymin&&l<c.ymax&&d.push(c.x+(l-c.ymin)*c.invSlope);if(d.length){d.sort((c,b)=>c-b);for(let c=0;c<d.length;c+=2){let b=Math.max(0,Math.floor(d[c])|0),f=Math.min(s-1,Math.ceil(d[c+1])|0),x=(l*s+b|0)*4;for(let p=b;p<=f;p++,x+=4){let g=h[x],w=h[x+1],y=h[x+2],T=h[x+3],[B,z,D,P]=S(g,w,y,T,e[0],e[1],e[2],e[3]);h[x]=B+.5|0,h[x+1]=z+.5|0,h[x+2]=D+.5|0,h[x+3]=P+.5|0}}}}}var M=(i,t,e,r,n=1)=>I(i,[t,e],r,n);function K(i,t,e,r,n=1,s=32){let o=[];for(let a=0;a<s;a++){let u=a/s*Math.PI*2;o.push(new m(t.x+e*Math.cos(u),t.y+e*Math.sin(u)))}I(i,o,r,n)}function J(i){if(!isFinite(i)||i<=0)return 0;let t=Math.abs(i);return t>=1?0:Math.min(6,Math.ceil(-Math.log10(t)))}function Q(i,t){let e=+i.toFixed(t);return(Math.abs(e)<1e-12?0:e).toFixed(t)}var _=class{constructor(t,e={}){this.vp=t;this.showGrid=e.showGrid!==!1,this.showAxes=e.showAxes!==!1,this.showTicks=e.showTicks!==!1,this.drawBorder=e.drawBorder||!1,this.axisAtZero=e.axisAtZero!==!1,this.gridColor=C(e.gridColor||"#2a2a2a"),this.axisColor=C(e.axisColor||"#888"),this.borderColor=C(e.borderColor||"#555"),this.tickSizePx=e.tickSizePx??6,this.tickThickness=e.tickThickness??1,this.axisThickness=e.axisThickness??2,this.font=e.font||"12px sans-serif",this.textColor=e.textColor||"#fff",this.margin=e.margin??30,this.labelOffset=e.labelOffset??10,this.numTicksX=e.numTicksX??5,this.numTicksY=e.numTicksY??5,this.axisXPos=0,this.axisYPos=0}setAxisPosition(t,e){this.axisXPos=t,this.axisYPos=e}setLabelStyle(t,e,r){this.font=t,this.textColor=e,r!==void 0&&(this.labelOffset=r)}computeTicks(t,e,r){let n=e-t;if(n===0)return[t];let s=n/r,o=Math.pow(10,Math.floor(Math.log10(s))),a=Math.ceil(s/o)*o,u=Math.ceil(t/a)*a,h=[];for(let l=u;l<=e;l+=a)h.push(+l.toFixed(6));return h}draw(t){let e=this.vp.viewport,r=this.vp.worldBounds;if(!e||!r)return;let n=this.computeTicks(r.xMin,r.xMax,this.numTicksX),s=this.computeTicks(r.yMin,r.yMax,this.numTicksY),o=J(Math.abs(n[1]-n[0]||1)),a=J(Math.abs(s[1]-s[0]||1)),u=this.axisAtZero&&r.yMin<=0&&r.yMax>=0?this.axisXPos:r.yMin,h=this.axisAtZero&&r.xMin<=0&&r.xMax>=0?this.axisYPos:r.xMin;if(this.showGrid){for(let l of n){let d=this.vp.worldToCanvas(l,r.yMin),c=this.vp.worldToCanvas(l,r.yMax);M(t,d,c,this.gridColor,1)}for(let l of s){let d=this.vp.worldToCanvas(r.xMin,l),c=this.vp.worldToCanvas(r.xMax,l);M(t,d,c,this.gridColor,1)}}if(this.showAxes){let l=this.vp.worldToCanvas(r.xMin,u),d=this.vp.worldToCanvas(r.xMax,u),c=this.vp.worldToCanvas(h,r.yMin),b=this.vp.worldToCanvas(h,r.yMax);M(t,l,d,this.axisColor,this.axisThickness),M(t,c,b,this.axisColor,this.axisThickness)}if(this.showTicks&&this.tickSizePx>0){let l=this.tickSizePx;for(let d of n){let c=this.vp.worldToCanvas(d,u);M(t,new m(c.x,c.y-l/2),new m(c.x,c.y+l/2),this.axisColor,this.tickThickness),t.drawText(Q(d,o),new m(c.x,c.y+this.labelOffset),this.textColor,this.font,"center","top")}for(let d of s){let c=this.vp.worldToCanvas(h,d);M(t,new m(c.x-l/2,c.y),new m(c.x+l/2,c.y),this.axisColor,this.tickThickness),t.drawText(Q(d,a),new m(c.x-this.labelOffset,c.y),this.textColor,this.font,"right","middle")}}}};var v=class i{constructor(t=1,e=0,r=0,n=1,s=0,o=0){this.a=t;this.b=e;this.c=r;this.d=n;this.e=s;this.f=o}static identity(){return new i}static translation(t,e){return new i(1,0,0,1,t,e)}static scale(t,e=t){return new i(t,0,0,e,0,0)}static rotation(t){let e=Math.cos(t),r=Math.sin(t);return new i(e,r,-r,e,0,0)}static fromCanvasTransform(t,e,r,n,s,o){return new i(t,e,r,n,s,o)}multiply(t){return new i(this.a*t.a+this.c*t.b,this.b*t.a+this.d*t.b,this.a*t.c+this.c*t.d,this.b*t.c+this.d*t.d,this.a*t.e+this.c*t.f+this.e,this.b*t.e+this.d*t.f+this.f)}transformV2(t){return new m(this.a*t.x+this.c*t.y+this.e,this.b*t.x+this.d*t.y+this.f)}static around(t,e){return i.translation(t.x,t.y).multiply(e).multiply(i.translation(-t.x,-t.y))}};var V=class{constructor(t="white",e=!1,r=null,n=v.identity(),s){this.color=t;this.fill=e;this.fillColor=r;this.transform=n;this.fillColor||(this.fillColor=t),this.legend=s}parseColorSafe(t){return[...C(t)??[255,255,255,255]]}},tt=class extends V{constructor(e,r={}){super(r.color??"red",r.fill??!1,r.fillColor??"rgba(255,0,0,0.3)",v.identity(),r.legend);this.data=e;this.baselineY=r.baselineY??0}draw(e,r){if(!this.data?.length)return;let n=r.worldToCanvas(this.data[0].x,this.data[0].y),s=this.parseColorSafe(this.color);for(let h=1;h<this.data.length;h++){let l=r.worldToCanvas(this.data[h].x,this.data[h].y);M(e,n,l,s),n=l}if(!this.fill)return;let o=this.data.map(h=>r.worldToCanvas(h.x,h.y)),a=this.data[this.data.length-1],u=this.data[0];o.push(r.worldToCanvas(a.x,this.baselineY)),o.push(r.worldToCanvas(u.x,this.baselineY)),A(e,o,this.parseColorSafe(this.fillColor))}},et=class extends V{constructor(e=new m(0,0),r=1,n={}){super(n.color??"white",n.fill??!1,n.fillColor??null,n.transform??v.identity(),n.legend);this.center=e;this.radius=r}draw(e,r){let n=this.transform.transformV2(this.center),s=r.worldToCanvas(n.x,n.y),o=r.scale,a=this.radius*(r.preserveAspect?o.x:(o.x+o.y)*.5);this.fill&&R(e,s,a,this.parseColorSafe(this.fillColor)),K(e,s,a,this.parseColorSafe(this.color))}},rt=class extends V{constructor(e,r,n={}){super(n.color??"yellow",!1,null,n.transform??v.identity(),n.legend);this.p1=e;this.p2=r;this.width=Math.max(1,(n.width??2)|0)}draw(e,r){let n=this.transform.transformV2(this.p1),s=this.transform.transformV2(this.p2),o=r.worldToCanvas(n.x,n.y),a=r.worldToCanvas(s.x,s.y);I(e,[o,a],this.parseColorSafe(this.color),this.width)}},nt=class extends V{constructor(e,r={}){super(r.color??"white",!1,null,r.transform??v.identity(),r.legend);this.pos=e;this.type=r.type??"circle",this.size=r.size??3}draw(e,r){let n=this.transform.transformV2(this.pos),s=r.worldToCanvas(n.x,n.y);N(e,s,this.parseColorSafe(this.color),{type:this.type,size:this.size})}},st=class extends V{constructor(t,e,r,n={}){super(n.color??"yellow",n.fill??!0,n.fillColor??"rgba(255,255,0,0.5)",n.transform??v.identity(),n.legend),this.points=[t,e,r]}draw(t,e){let n=this.points.map(s=>this.transform.transformV2(s)).map(s=>e.worldToCanvas(s.x,s.y));this.fill&&A(t,n,this.parseColorSafe(this.fillColor));for(let s=0;s<3;s++)M(t,n[s],n[(s+1)%3],this.parseColorSafe(this.color))}},it=class extends V{constructor(e,r,n={}){super(n.color??"white",!1,null,n.transform??v.identity(),n.legend);this.text=e;this.pos=r;this.font=n.font??"14px sans-serif",this.align=n.align??"left",this.baseline=n.baseline??"alphabetic"}draw(e,r){let n=this.transform.transformV2(this.pos),s=r.worldToCanvas(n.x,n.y);e.drawText(this.text,s,this.color,this.font,this.align,this.baseline)}},ot=class extends V{constructor(e,r,n={}){super(n.color??"white",!1,null,n.transform??v.identity(),n.legend);this.text=e;this.pos=r;this.mode=n.mode??"world",this.font=n.font??"14px sans-serif",this.align=n.align??"left",this.baseline=n.baseline??"alphabetic"}draw(e,r){let n=this.mode==="canvas"?this.pos:r.worldToCanvas(this.transform.transformV2(this.pos).x,this.transform.transformV2(this.pos).y);e.drawText(this.text,n,this.color,this.font,this.align,this.baseline)}};var E=class{constructor(t,e,r={x:0,y:0,width:t.size.x,height:t.size.y},n=!1){this.app=t;this.worldBounds=e;this._viewport=r;this.preserveAspect=n;this.xTicks=[];this.yTicks=[]}get viewport(){return typeof this._viewport=="function"?this._viewport(this.app):this._viewport}get scale(){let{xMin:t,xMax:e,yMin:r,yMax:n}=this.worldBounds,s=e-t,o=n-r,a=this.viewport;if(!this.preserveAspect||this.preserveAspect==="none")return new m(a.width/s,a.height/o);let u=a.width/a.height,h=s/o,l=u>h?a.height/o:a.width/s;return new m(l,l)}worldToCanvas(t,e){let r=this.viewport,{xMin:n,xMax:s,yMin:o,yMax:a}=this.worldBounds,u=s-n,h=a-o;if(this.preserveAspect&&this.preserveAspect!=="none"){let l=this.scale.x,d=l*u,c=l*h,b=r.x+(r.width-d)/2,f=r.y+(r.height-c)/2;return new m(b+(t-n)*l,f+(h-(e-o))*l)}else{let l=this.scale;return new m(r.x+(t-n)*l.x,r.y+(a-e)*l.y)}}canvasToWorld(t,e){let r=this.viewport,{xMin:n,xMax:s,yMin:o,yMax:a}=this.worldBounds,u=s-n,h=a-o;if(this.preserveAspect&&this.preserveAspect!=="none"){let l=this.scale.x,d=l*u,c=l*h,b=r.x+(r.width-d)/2,f=r.y+(r.height-c)/2;return new m(n+(t-b)/l,a-(e-f)/l)}else{let l=this.scale;return new m(n+(t-r.x)/l.x,a-(e-r.y)/l.y)}}unitsToPixels(t){return t*this.scale.x}updateWorld(t,e=10){t&&(this.worldBounds=t);let{xMin:r,xMax:n,yMin:s,yMax:o}=this.worldBounds;this.xTicks=this.computeTicks(r,n,e),this.yTicks=this.computeTicks(s,o,e)}computeTicks(t,e,r){let n=e-t;if(n<=0)return[t];let s=this.nicify(n/r),o=Math.ceil(t/s)*s,a=[];for(let u=o;u<=e;u+=s)a.push(+u.toFixed(10));return a}nicify(t){let e=Math.floor(Math.log10(t)),r=t/Math.pow(10,e),n;return r<1.5?n=1:r<3?n=2:r<7?n=5:n=10,n*Math.pow(10,e)}};function mt(i,t=1,e=30){let r=i.getBoundingClientRect(),n=r.width,s=r.height;return n/s>t?n=s*t:s=n/t,{x:e,y:e,width:n-e*2,height:s-e*2,margin:e}}var O=class{constructor(t,e){this.width=0;this.height=0;this.imageData=new ImageData(Math.max(1,t|0),Math.max(1,e|0)),this.pixels=this.imageData.data,this.px32=new Uint32Array(this.pixels.buffer),this.width=this.imageData.width,this.height=this.imageData.height}resize(t,e){this.imageData=new ImageData(Math.max(1,t|0),Math.max(1,e|0)),this.pixels=this.imageData.data,this.px32=new Uint32Array(this.pixels.buffer),this.width=this.imageData.width,this.height=this.imageData.height}clear(t="#131313"){let e=C(t)||k.black,r=$(e[0],e[1],e[2],e[3]);this.px32.fill(r)}index(t,e){return(e*this.width+t|0)*4}putPixel(t,e,r){if(t>>>0>=this.width>>>0||e>>>0>=this.height>>>0)return;let n=this.index(t|0,e|0),s=r;this.pixels[n]=s[0],this.pixels[n+1]=s[1],this.pixels[n+2]=s[2],this.pixels[n+3]=s[3]}putPixelBlend(t,e,r){if(t>>>0>=this.width>>>0||e>>>0>=this.height>>>0)return;let n=this.index(t|0,e|0),s=this.pixels[n],o=this.pixels[n+1],a=this.pixels[n+2],u=this.pixels[n+3],[h,l,d,c]=S(s,o,a,u,r[0],r[1],r[2],r[3]);this.pixels[n]=h+.5|0,this.pixels[n+1]=l+.5|0,this.pixels[n+2]=d+.5|0,this.pixels[n+3]=c+.5|0}blit(t,e,r){let n=t.width|0,s=t.height|0,o=t.data,a=this.width,u=this.height;e|=0,r|=0;let h=Math.max(0,e),l=Math.max(0,r),d=Math.min(a,e+n),c=Math.min(u,r+s);for(let b=l-r;b<c-r;b++){let x=(r+b)*a;for(let p=h-e;p<d-e;p++){let g=e+p,w=(b*n+p)*4,y=(x+g)*4,T=this.pixels[y],B=this.pixels[y+1],z=this.pixels[y+2],D=this.pixels[y+3],P=o[w],ct=o[w+1],ht=o[w+2],U=o[w+3],L=U/255,Y=1-L;this.pixels[y]=P*L+T*Y+.5|0,this.pixels[y+1]=ct*L+B*Y+.5|0,this.pixels[y+2]=ht*L+z*Y+.5|0,this.pixels[y+3]=U*L+D*Y+.5|0}}}};var W=class{constructor(t=256){this.capacity=t;this.map=new Map;this.capacity|=0}get(t){let e=this.map.get(t);return e&&(this.map.delete(t),this.map.set(t,e)),e??null}set(t,e){for(this.map.has(t)&&this.map.delete(t),this.map.set(t,e);this.map.size>this.capacity;){let r=this.map.keys().next().value;r!==void 0&&this.map.delete(r)}}clear(){this.map.clear()}};var H=class{constructor(t=document.querySelector("canvas")){this.canvas=t;this.resizeCallbacks=[];this.renderables=[];this.ctx=t.getContext("2d"),this.size=new m(t.width,t.height),this.buffer=new O(this.size.x,this.size.y),this.textCanvas=document.createElement("canvas"),this.textCtx=this.textCanvas.getContext("2d"),this.textCache=new W(512),window.addEventListener("resize",()=>this.onResize())}resizeCanvas(){this.canvas.width=this.size.x,this.canvas.height=this.size.y}onResize(){this.size=new m(window.innerWidth|0,window.innerHeight|0),this.resizeCanvas(),this.buffer.resize(this.size.x,this.size.y),this.renderAll(),this.resizeCallbacks.forEach(t=>t())}onResizeCallback(t){this.resizeCallbacks.push(t)}addRenderable(t){this.renderables.push(t)}clear(t="#131313"){this.buffer.clear(t)}putPixel(t,e){this.buffer.putPixel(t.x|0,t.y|0,e)}putPixelBlend(t,e){this.buffer.putPixelBlend(t.x|0,t.y|0,e)}blitImageData(t,e,r){this.buffer.blit(t,e,r)}render(){this.ctx.putImageData(this.buffer.imageData,0,0)}renderAll(){this.clear(),this.renderables.forEach(t=>t.draw(this)),this.render()}drawText(t,e,r="#fff",n="12px sans-serif",s="left",o="alphabetic"){let a=`${t}|${n}|${r}`,u=this.textCache.get(a);if(!u){let b=this.textCtx;b.font=n;let f=b.measureText(t),x=Math.ceil(f.width+4),p=Math.ceil((f.actualBoundingBoxAscent||10)+(f.actualBoundingBoxDescent||4)+4);(this.textCanvas.width<x||this.textCanvas.height<p)&&(this.textCanvas.width=x,this.textCanvas.height=p),b.clearRect(0,0,x,p),b.font=n,b.fillStyle=r,b.textBaseline="top",b.textAlign="left",b.fillText(t,2,2),u=b.getImageData(0,0,x,p),this.textCache.set(a,u)}let{width:h,height:l}=u,d=0,c=0;switch(s){case"center":d=-h/2;break;case"right":case"end":d=-h;break}switch(o){case"top":c=0;break;case"middle":c=-l/2;break;case"bottom":case"ideographic":c=-l;break;case"alphabetic":c=-l;break}this.blitImageData(u,e.x+d+.5|0,e.y+c+.5|0)}},F=class{constructor(t,e={}){this.containerDiv=t;let r=document.createElement("canvas");t.appendChild(r),Object.assign(r.style,{width:"100%",height:"100%",display:"block",background:e.background||"black"}),this.app=new H(r),window.addEventListener("resize",()=>this.resize()),this.resize()}resize(){let t=this.containerDiv.getBoundingClientRect(),e=Math.max(1,t.width|0),r=Math.max(1,t.height|0),n=this.app.canvas;n.width=e,n.height=r,this.app.size=new m(e,r),this.app.buffer.resize(e,r)}clear(){this.app.clear()}render(){this.app.render()}};function dt(i,t,e){return i.rotate(e,t)}function Ut(i,t,e){i.points=i.points.map(r=>dt(r,t,e))}function $t(i,t,e){let r=v.around(t,v.scale(Math.cos(e),1));i.points=i.points.map(n=>r.transformV2(n))}function bt(i,t,e){return v.around(t,v.scale(Math.cos(e),1)).transformV2(i)}var q=class i{static findX(t){let e=[];for(let r=1;r<t.length;r++){let n=t[r-1].y,s=t[r].y;if(n===0)e.push(t[r-1].x);else if(n*s<0){let o=t[r-1].x,a=t[r].x;e.push(o+-n/(s-n)*(a-o))}}return e}static drawX(t,e,r,n="yellow"){let s=C(n)||k.yellow,o=i.findX(r);for(let a of o){let u=e.worldToCanvas(a,0);R(t,new m(u.x+.5|0,u.y+.5|0),5,s)}}};var at=class{constructor(){this.layers=[]}add(t,e="default"){let r=Array.isArray(t)?t:[t],n=this.layers.find(s=>s.name===e);return n||(n={name:e,drawables:[]},this.layers.push(n),this.sortLayers()),n.drawables.push(...r),this}remove(t){for(let e of this.layers)e.drawables=e.drawables.filter(r=>r!==t);return this}clear(t){if(t){let e=this.layers.find(r=>r.name===t);e&&(e.drawables.length=0)}else this.layers.length=0;return this}draw(t,e){for(let n of this.layers)if(n.name!=="debug")for(let s of n.drawables)s.visible!==!1&&s.draw(t,e);let r=this.layers.find(n=>n.name==="debug");if(r)for(let n of r.drawables)n.visible!==!1&&(n.ignoreViewport?n.draw(t,void 0):n.draw(t,e))}collectLegend(){let t=[];for(let e of this.layers)for(let r of e.drawables){let n=r.legend;n&&t.push({label:n.label,color:n.color??r.color??"#fff",symbol:n.symbol??"line"})}return t}sortLayers(){this.layers.sort((t,e)=>t.name==="debug"?1:e.name==="debug"?-1:t.name.localeCompare(e.name))}};var Z=class{constructor(t,e,r="#fff",n="16px monospace"){this.text=t;this.pos=e;this.color=r;this.font=n}draw(t,e=2){let r=new m(this.pos.x+e,this.pos.y+e);t.drawText(this.text,r,this.color,this.font,"left","top")}},lt=class i extends V{constructor(e=new m(10,10),r=2){super("white",!1,null);this.elements=[];this.lastTime=performance.now();this.visible=!0;this.ignoreViewport=!0;this.margin=r;let n=new Z("FPS: 0",e);this.elements.push(n),i.registry.push(this)}static{this.registry=[]}update(){let e=performance.now(),r=e-this.lastTime,n=r>0?Math.round(1e3/r):0;this.elements[0].text=`FPS: ${n}`,this.lastTime=e}draw(e){if(this.visible)for(let r of this.elements)r.draw(e,this.margin)}static updateAll(){for(let e of i.registry)e.update()}};var j=class extends V{constructor(e,r={}){super("white",!1,null);this.items=e;this.options=r}estimateTextWidth(e,r){let n=/(\d+)\s*px/.exec(r),s=n?parseInt(n[1],10):12;return Math.max(8,Math.round(e.length*s*.6))}draw(e,r){let n={anchor:this.options.anchor??"ne",padding:this.options.padding??8,gap:this.options.gap??6,swatchSize:this.options.swatchSize??14,font:this.options.font??"12px sans-serif",textColor:this.options.textColor??"#fff",background:this.options.background===void 0?"rgba(0,0,0,0.35)":this.options.background,boxOffset:this.options.boxOffset??new m(0,0),maxWidthPx:this.options.maxWidthPx??0};if(!this.items?.length)return;let s=r.viewport,o=n.padding,a=n.swatchSize,u=Math.max(a,12)+n.gap,h=0;for(let g of this.items)h=Math.max(h,this.estimateTextWidth(g.label,n.font));let l=a+6+h,d=(n.maxWidthPx&&n.maxWidthPx>l?n.maxWidthPx:l)+o*2,c=this.items.length*u-n.gap+o*2,b=0,f=0;switch(n.anchor){case"ne":b=s.x+s.width-d-4,f=s.y+4;break;case"nw":b=s.x+4,f=s.y+4;break;case"se":b=s.x+s.width-d-4,f=s.y+s.height-c-4;break;case"sw":b=s.x+4,f=s.y+s.height-c-4;break}if(b+=n.boxOffset.x,f+=n.boxOffset.y,n.background){let g=C(n.background)||[0,0,0,128],w=[new m(b,f),new m(b+d,f),new m(b+d,f+c),new m(b,f+c)];A(e,w,g)}let x=b+o,p=f+o+u/2;for(let g of this.items){let w=C(g.color)||[255,255,255,255],y=g.symbol??"line";if(y==="marker")R(e,new m(Math.round(x+a/2),Math.round(p)),Math.max(3,Math.floor(a/3)),w);else if(y==="area"){let T=[new m(x,p-a/2+3),new m(x+a,p-a/2+3),new m(x+a,p+a/2-3),new m(x,p+a/2-3)];A(e,T,w),M(e,new m(x,p-a/2),new m(x+a,p-a/2),w,1)}else M(e,new m(x,p),new m(x+a,p),w,2);e.drawText(g.label,new m(x+a+6,p),n.textColor,n.font,"left","middle"),p+=u}}};export{H as CanvasRenderer,lt as DebugUI,V as Drawable,et as DrawableCircle,tt as DrawableFunction,ot as DrawableLabel,j as DrawableLegend,rt as DrawableLine,nt as DrawablePoint,it as DrawableText,st as DrawableTriangle,F as DynamicCanvasRenderer,_ as Graph,q as Intercepts,k as NAMED,O as PixelBuffer,at as Scene,W as TextCache,v as Transform2D,m as V2,E as ViewportManager,S as blendRGBA,ut as clamp01,X as clamp255,K as drawCircleOutline,M as drawLine,R as fillCircle,A as fillPolygon,mt as getDivViewport,$ as packABGR,C as parseColor,bt as projectYRotation,G as rawLine,N as rawPoint,dt as rotatePoint,Ut as rotateTriangleAroundCenter,$t as rotateTriangleVertical,I as strokeShape,pt as toColor,xt as unpackABGR};
//# sourceMappingURL=canvasLib.js.map
